; config/supervisord.conf
[supervisord]
nodaemon=true ; Manter o supervisor rodando em primeiro plano (essencial para o Docker)

; 1. X Virtual Framebuffer (Tela Virtual)
[program:xvfb]
command=/usr/bin/Xvfb :99 -screen 0 1280x720x24
autorestart=true
startsecs=5 ; Dá tempo para o Xvfb iniciar antes do VNC
priority=10

; 2. Servidor VNC (x11vnc)
; :99 é a tela virtual criada pelo Xvfb
[program:x11vnc]
command=/usr/bin/x11vnc -display :99 -passwd vncpassword -forever -shared -rfbport 5900 -xkb -loop
environment=HOME="/tmp"
autorestart=true
priority=20
startsecs=5

; 3. Proxy WebSocket (websockify)
; Converte o VNC (porta 5900) para WebSocket (porta 6080 - padrão noVNC)
[program:websockify]
command=/usr/bin/websockify --web /opt/novnc 6080 localhost:5900
autorestart=true
priority=30
startsecs=3

; 4. Aplicação FastAPI
; Roda a API no display virtual Xvfb (DISPLAY=:99)
[program:fastapi]
command=/usr/bin/python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000
directory=/app
environment=DISPLAY=:99,HEADLESS=false,API_VERSION="1.1 (VNC)" ; HEADLESS=false para que o Playwright abra a GUI
autorestart=true
priority=40
startsecs=5